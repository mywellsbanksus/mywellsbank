var BootStrapC2C=function(t){for(var e in t=Object(t),this.accessibilityMessages={end:"End Chat",resume:"Resume Chat",start:"Start Chat",onMinimize:"Chat window minimized. To resume, select chat button or press alt plus 1",newMessageSingular:"You have {count} unread message.",newMessagePlural:"You have {count} unread messages.",onDisplay:"Chat available, press ALT plus 1 to open",openChat:"Chat window open, press ALT plus 2 to minimize and ALT plus 9 to end chat."},t.accessibilityMessages)this.accessibilityMessages[e]=t.accessibilityMessages[e];this.animate=void 0===t.animate||t.animate,this.animateDelay=t.animateDelay||1e3,this.c2cR=t.right||20,this.c2cB=t.bottom||20,this.width=t.width||56,this.height=t.height||56,this.backgroundRColor=t.readyBackgroundColor,this.backgroundRImage=t.readyBackgroundImageURL,this.backgroundAHColor=t.afterHoursBackgroundColor,this.backgroundAHImage=t.afterHoursBackgroundImageURL,this.backgroundDColor=t.disabledBackgroundColor,this.backgroundDImage=t.disabledBackgroundImageURL,this.backgroundBColor=t.buzyBackgroundColor,this.backgroundBImage=t.buzyBackgroundImageURL,this.backgroundMColor=t.minimizedBackgroundColor,this.backgroundMImage=t.minimizedBackgroundImageURL,this.closeBtn=void 0===t.closeBtnOnActive||t.closeBtnOnActive,this.htmlRContent=t.readyHtmlContent,this.htmlDContent=t.disabledHtmlContent,this.htmlAHContent=t.afterHoursHtmlContent,this.htmlBContent=t.buzyHtmlContent,this.htmlMContent=t.minimizedHtmlContent,this.flyInOpener=void 0!==t.flyInWelcomePopup&&t.flyInWelcomePopup,this.flyInOpenerMsg=t.flyInWelcomeMsg||"We are here, lets Chat!",this.useOpener=t.useOpenerForWelcomeMsg,this.flyInHeader=t.flyInHeader||"Bot Support",this.flyInDelay=t.flyInWelcomeDelay||3e3,this.flyInUrl=t.flyInAvatarUrl,this.flyInW=t.flyInAvatarWidth||30,this.flyInH=t.flyInAvatarHeight||30,this.showMinimizedBadge=void 0===t.showMinimizedBadge||t.showMinimizedBadge,this.showFlyinMinimizedMessage=void 0===t.showFlyinMinimizedMessage||t.showFlyinMinimizedMessage,this.allowDragging=void 0===t.dragEnabled||t.dragEnabled,this.parentElement=t.parentElement,this.richPayload=t.openerWidget,this.openerWidgetCallback=t.openerWidgetCallback,this.minPayload=t.minimizedWidget,this.minWidgetCallback=t.minimizedWidgetCallback,this.onC2CClickedBind=this.onC2CClicked.bind(this),this.onC2CKeyPressedBind=this.onC2CKeyPressed.bind(this),this.onC2CKeydownBind=this.onC2CKeydown.bind(this),this.ariaReaderAlert=new this.ariaReader({cssName:"alerts",initMsg:this.accessibilityMessages.onDisplay,role:"alert"}),this.ariaReaderStatus=new this.ariaReader({cssName:"status",role:"status"}),this.isChatLoadedOnce=!1,this.isChatDisplayedOnce=!1};BootStrapC2C.prototype.renderC2CButton=function(e,s){var a,n,o,r="";function t(){switch(a.classList.remove("ready","afterHours","disabled","buzy","minimized"),a.innerHTML="",e.image){case"r":if(this._setC2CButtonAccessibilityMessage(this.accessibilityMessages.start),a.classList.add("ready"),n=this.backgroundRColor,o=this.backgroundRImage,r=this.htmlRContent||"<span class='chat-icon'></span>",this.isChatLoadedOnce||(this.ariaReaderAlert.setMessage(this.accessibilityMessages.onDisplay),this.isChatLoadedOnce=!0),this.flyInOpener&&!e.reDisplay){var i=this;this.flyInTimer=setTimeout(function(){i.displayFlyInOpener(),i.flyInOpenerMsg&&!i.useOpener?i.flyInContent(i.flyInUrl,i.flyInW,i.flyInH,i.flyInOpenerMsg):e.opID&&i.useOpener&&NuanMessaging.CIAPI.getOpenerScripts(function(t){var e=(new DOMParser).parseFromString(t,"text/xml");i.flyInContent(i.flyInUrl,i.flyInW,i.flyInH,e.getElementsByTagName("script")[0].textContent)},e.opID),i.richPayload&&i.renderRichWidgetInOpener(i.richPayload,i.openerWidgetCallback)},this.flyInDelay)}e.reDisplay&&a.focus();break;case"ah":a.classList.add("afterHours"),n=this.backgroundAHColor,o=this.backgroundAHImage,r=this.htmlAHContent;break;case"d":a.classList.add("disabled"),n=this.backgroundDColor,o=this.backgroundDImage,this.closeBtn?(a.setAttribute("tabindex","0"),r=this.htmlDContent||"<span class='chat-close'></span>",s?(this.ariaReaderAlert.setMessage(this.accessibilityMessages.openChat),this.isChatDisplayedOnce=!0):this._setC2CButtonAccessibilityMessage(this.accessibilityMessages.end)):r=this.htmlDContent;break;case"b":a.classList.add("buzy"),n=this.backgroundBColor,o=this.backgroundBImage,r=this.htmlBContent;break;case"m":var t=window.mwfGlobals&&window.mwfGlobals.customerType&&"TPB"===window.mwfGlobals.customerType?"#353B6B":"";this._setC2CButtonAccessibilityMessage(this.accessibilityMessages.resume),a.setAttribute("tabindex","0"),a.classList.add("minimized"),n=this.backgroundMColor||t,o=this.backgroundMImage,r=this.htmlMContent||"<span class='chat-minimize'></span>",this.ariaReaderStatus.setMessage(this.accessibilityMessages.onMinimize),this.setAriaNewUnreadMessage(e.count||0),this.showMinimizedBadge&&(this.countEl=null,r+=this.addMinimizedBadge(e.count||0)),e.reDisplay||setTimeout(function(){a.focus()},250);break;default:a.setAttribute("tabindex","-1"),n="transparent"}r&&(a.innerHTML=r),n&&(a.style.background=n),o&&(a.style.background=["url('",o,"')"].join("")),o||n||a.style.removeProperty("background")}this.c2cData=e,this.didShow=!0,this.eDiv?(a=this.eDiv,this.resetState()):((a=document.createElement("button")).classList.add("nuance-chat-button"),a.style.right=this.c2cR+"px",a.style.bottom=this.c2cB+"px",a.style.width=this.width+"px",a.style.height=this.height+"px",this.animate&&a.classList.add("animate"),this.parentElement.appendChild(a),this.allowDragging||(a.style.position="fixed"),this.eDiv=a,this.ariaReaderStatus.setParent(this.parentElement,!0),this.ariaReaderAlert.setParent(this.parentElement,!0)),this.animate?setTimeout(function(){t.call(this),a.classList.add("enter")}.bind(this),this.animateDelay):(t.call(this),a.classList.add("enter")),a.idx=e.c2cIdx,(e.launchable||"chatactive"==e.displayState&&this.closeBtn)&&(a.addEventListener("click",this.onC2CClickedBind),a.addEventListener("keydown",this.onC2CKeydownBind),window.addEventListener("keydown",this.onC2CKeyPressedBind))},BootStrapC2C.prototype.ariaReader=function(t){var i,e=_lastMsg="",s="log",a="";function n(){var t=_lastMsg||e;return"<div class='aria-reader "+a+"' role='"+s+"' aria-live='polite'>"+t+"</div>"}function o(){if(i)return i.querySelector(".aria-reader"+(a?"."+a:""))}return(t=t||{}).initMsg&&(e=t.initMsg),t.role&&(s=t.role),t.cssName&&(a=t.cssName),{getHtml:n,setParent:function(t,e){i=t,e&&function(){if(!o()){var t=(new DOMParser).parseFromString(n(),"text/html");i.appendChild(t.body.firstChild)}}()},setMessage:function(t){var e=o();e&&(e.style.display="",e.innerHTML=t,setTimeout(function(){e.style.display="none"},1500)),_lastMsg=t},reset:function(){var t=o();t&&(t.innerHTML="")}}},BootStrapC2C.prototype.setAriaNewUnreadMessage=function(t){if(!(t<=0)){var e=this.accessibilityMessages.newMessageSingular;1<t&&(e=this.accessibilityMessages.newMessagePlural),e=e.replace("{count}",t),this.ariaReaderStatus.setMessage(e)}},BootStrapC2C.prototype.renderState=function(t,e){this.c2cData.image=t,this.c2cData.launchable=e.launchable,this.c2cData.c2cIdx=e.c2cIdx,this.renderC2CButton(this.c2cData,!this.isChatDisplayedOnce)},BootStrapC2C.prototype.getHeight=function(){return this.c2cB+this.height+20},BootStrapC2C.prototype.showDisabled=function(){this.c2cData.image="d",this.c2cData.launchable=!1,this.renderC2CButton(this.c2cData,!this.isChatDisplayedOnce)},BootStrapC2C.prototype.setParentElement=function(t){this.parentElement=t},BootStrapC2C.prototype.resetState=function(){this.eDiv.classList.remove("enter"),this._setC2CButtonAccessibilityMessage(""),this.eDiv.setAttribute("tabindex","-1")},BootStrapC2C.prototype.isDisplayed=function(){return this.didShow},BootStrapC2C.prototype.onC2CClicked=function(){this.closeBtn&&"d"==this.c2cData.image?this.onClose():"r"==this.c2cData.image?(NuanMessaging.CIAPI.onC2CClicked(this.c2cData.c2cIdx),-1!=this.flyInTimer&&clearTimeout(this.flyInTimer)):"m"==this.c2cData.image&&(NuanMessaging.SDKAPI.onRestoredClicked(),this.c2cData.count=0),this.flyInClose()},BootStrapC2C.prototype.onC2CKeydown=function(t){13==t.keyCode&&this.onC2CClicked()},BootStrapC2C.prototype.addMinimizedBadge=function(t){var e=window.mwfGlobals&&window.mwfGlobals.customerType&&"TPB"===window.mwfGlobals.customerType?"#353B6B":"";return["<div aria-hidden='true' class='badge hide",0<t?" show":"","'><div class='message-count'",e?"style=background-color:"+e:"",">",t,"</div></div>"].join("")},BootStrapC2C.prototype.newMinimizedMessage=function(t,e){if(this.showMinimizedBadge){if(!this.countEl){var i=this.eDiv.querySelector(".badge");i.classList.contains("show")||i.classList.add("show"),this.countEl=i.querySelector(".message-count")}this.countEl.innerText=t}if(e&&e.data){var s=e.data.chatFinalText||e.data.messageText;if(this.showFlyinMinimizedMessage&&s){var a=!1;this.flyel?a=!0:(this.displayFlyInOpener(),this.minPayload&&this.renderRichWidgetInOpener(this.minPayload,this.minWidgetCallback)),this.flyInContent(this.flyInMinImgUrl,this.flyInW,this.flyInH,s.replace("href",'href="javascript:void(0)"'),a)}}this.setAriaNewUnreadMessage(t)},BootStrapC2C.prototype.displayFlyInOpener=function(){var t=document.createDocumentFragment(),e=document.createElement("div");e.classList.add("nuan-flyin-opener"),e.style.right="86px",e.style.bottom="21px";var i=["<div class='closeBtnCont'><div class='flyin-close-btn' tabindex='0' role='button'><svg width='10px' height='10px' viewBox='0 0 14 14'><g stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'><g transform='translate(-419.000000, -413.000000)'><g transform='translate(164.000000, 396.000000)'><g><g transform='translate(250.000000, 12.000000)'><g><g><rect opacity='0.200000003' x='0' y='0' width='24' height='24'></rect><g transform='translate(4.000000, 4.000000)' fill='#000000'><rect transform='translate(8.000000, 8.000000) rotate(45.000000) translate(-8.000000, -8.000000) ' x='7' y='-1' width='2' height='18' rx='1'></rect><rect transform='translate(8.000000, 8.000000) rotate(135.000000) translate(-8.000000, -8.000000) ' x='7' y='-1' width='2' height='18' rx='1'></rect></g></g></g></g></g></g></g></g></svg></div></div>","<div class='flyInHeader'><strong>",this.flyInHeader,"</strong></div>"];i.push("<div class='opener-container'> </div><div class='opener-container-arrow'> </div></div>"),e.innerHTML=i.join(""),t.appendChild(e),e.addEventListener("click",this.flyInClose.bind(this)),this.flyel=e,this.parentElement.appendChild(t),setTimeout(function(){e.classList.add("enter")},this.animateDelay)},BootStrapC2C.prototype.flyInContent=function(t,e,i,s,a){var n=this.flyel.querySelector(".opener-container"),o=["<div class='flyinOpenerContainer",a?" animate":"","'>"];t&&(o.push("<div class='flyInMsgAwatarCont'>"),o.push("<img class='flyInMsgAwatar' src=",t," width=",e," height=",i,">"),o.push("</div>")),o.push("<div class='flyin-bubble-msg-container' style='margin-left:px;'><div class='flyin-bubble-text'>",s,"</div></div></div>"),n.insertAdjacentHTML("beforeend",o.join("")),a&&setTimeout(function(){n.lastChild.classList.add("enter")}.bind(this),this.animateDelay)},BootStrapC2C.prototype.resetBadge=function(){this.countEl&&(this.countEl.innerText="0")},BootStrapC2C.prototype.renderRichWidgetInOpener=function(t,e){var i=document.createElement("div");i.classList.add("flyin-widget"),RichMain.instance.renderRichContent(t,i,"",!1).registerCBListener(function(t){e&&e(t,this.c2cData),this.flyInClose()}.bind(this)),this.flyel.appendChild(i)},BootStrapC2C.prototype.flyInClose=function(){this.flyel&&(this.flyel.parentNode.removeChild(this.flyel),this.flyel=null)},BootStrapC2C.prototype.onClose=function(){NuanMessaging.CIAPI.confirmAndClose()},BootStrapC2C.prototype.clearListeners=function(){this.eDiv.removeEventListener("click",this.onC2CClickedBind),this.eDiv.removeEventListener("keydown",this.onC2CKeydownBind),window.removeEventListener("keydown",this.onC2CKeyPressedBind)},BootStrapC2C.prototype.clear=function(){this.didShow=!1,this.resetState(),-1!=this.flyInTimer&&clearTimeout(this.flyInTimer),this.flyInClose()},BootStrapC2C.prototype.isCloseBtnDisplayed=function(){return this.closeBtn},BootStrapC2C.prototype._setC2CButtonAccessibilityMessage=function(t){this.eDiv.setAttribute("title",t)},BootStrapC2C.prototype.onC2CKeyPressed=function(t){t.altKey&&57===t.keyCode&&"m"!==this.c2cData.image&&this.onClose(),t.altKey&&49===t.keyCode&&("r"===this.c2cData.image?(NuanMessaging.CIAPI.onC2CClicked(this.c2cData.c2cIdx),-1!=this.flyInTimer&&clearTimeout(this.flyInTimer)):"m"===this.c2cData.image&&(NuanMessaging.SDKAPI.onRestoredClicked(),this.c2cData.count=0)),t.altKey&&50===t.keyCode&&NuanMessaging.SDKAPI.ciMinimize(),this.flyInClose()};