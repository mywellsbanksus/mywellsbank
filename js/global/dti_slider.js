(function(global){var wrapper=function($){var pluginName="generateDTIGraph";var defaults={range:{"min":[0],"max":[100]},updateState:function(n){return n;},enableSlider:false};var Plugin=function(element,options){var self=this;self.$el=$(element);self.data=self.$el.data();self.totalIncome=self.data.totalIncome;self.totalDebt=self.data.totalDebt;self.$dtiWrapper=$("<div>",{"class":"dti-graph-holder"});self.$el.prepend(self.$dtiWrapper);self.graphWrapperWidth=getViewportOffset(self.$dtiWrapper).width;self.settings=$.extend({},defaults,options);self.init();};var getViewportOffset=function(el){var elOffset=$(el).offset();var elWidth=$(el).width();var elHeight=$(el).height();var vWidth=$(window).innerWidth();var vHeight=$(window).innerHeight();return{"left":elOffset.left-$(window).scrollLeft(),"top":elOffset.top-$(window).scrollTop(),"width":elWidth,"height":elHeight,"viewportWidth":vWidth,"viewportHeight":vHeight};};var getDebtPercentage=function(num1,num2){var score=Math.round(Number(num1)/Number(num2)*100);score=Math.min(100,score);score=Math.max(0,score);if(num2===0){score=100;}if(num1===0){score=0;}return score;};var formatNumber=function(num){return num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,");};Plugin.prototype={_createGraph:function(){var self=this;self.totalIncome=Number(self.data.totalIncome.toString().replace(/,/g,""));self.totalDebt=Number(self.data.totalDebt.toString().replace(/,/g,""));var score=getDebtPercentage(self.totalDebt,self.totalIncome);if($(".graph-tbl").length>0){$(".graph-tbl").remove();}var graphTbl=$("<table>",{"width":self.graphWrapperWidth,"class":"graph-tbl"});var tableRow=$("<tr/>").appendTo(graphTbl),tableDebtData=$("<td>",{"class":"debt-data","style":"width:"+score+"%"}).appendTo(tableRow),tableIncomeData=$("<td>",{"class":"income-data","style":"width:"+(100-Number(score))+"%"}).appendTo(tableRow);self.$dtiWrapper.prepend(graphTbl);self._createLabel(score);self._enableCallOut(score);self.$el.trigger("showHideDtiContent",[score]);},_createLabel:function(score){var self=this;if($(".debt-income-lbl").length>0){$(".debt-income-lbl").remove();}var dataForLbl=self.$el.data().debtIncomeLbl[0],debt=Math.round(self.totalDebt),remainingIncome=self.totalIncome-debt;remainingIncome=Math.max(0,remainingIncome);var debtIncomeLbl=$("<div>",{"class":"clearfix debt-income-lbl"}),debtLbl=$("<div>",{"html":dataForLbl.debtTxt+": $"+formatNumber(debt),"class":"debt-lbl",}).appendTo(debtIncomeLbl),incomeLbl=$("<div>",{"html":dataForLbl.remainingIncomeTxt+": $"+formatNumber(remainingIncome),"class":"income-lbl",}).appendTo(debtIncomeLbl);self.$dtiWrapper.prepend(debtIncomeLbl);},_enableCallOut:function(score){var self=this;if($(".pointer").length>0){$(".pointer").remove();}var pointer=$("<div>",{"class":"pointer"});self.$dtiWrapper.prepend(pointer);var wrapperWidth=getViewportOffset(self.$dtiWrapper).width;var xMovement=(wrapperWidth/100*score)-10;if(xMovement<=0){xMovement=0;}if(xMovement>=(Number(wrapperWidth)-20)){xMovement=Number(wrapperWidth)-20;}pointer.css("left",xMovement);if($(".callout").length>0){$(".callout").remove();}var callOutTxt=self.settings.updateState(score);var callOutContent=$("<div>",{"class":"callout score-wrapper"}),percentileTxt=$("<span>",{"class":"score-txt"}).html(score).appendTo(callOutContent),percentileSym=$("<span>",{"class":"score-sym"}).html("%").appendTo(callOutContent),percentileMsg=$("<span>",{"class":"score-msg"}).html(callOutTxt).appendTo(callOutContent);self.$dtiWrapper.prepend(callOutContent);var callOutWidth=getViewportOffset(callOutContent).width+30;var xCallOutMovement=(wrapperWidth/100*score)-(callOutWidth/2);if(xCallOutMovement<=0){xCallOutMovement=0;}if(xCallOutMovement>=(wrapperWidth-callOutWidth)){xCallOutMovement=(wrapperWidth-callOutWidth);}callOutContent.css("left",xCallOutMovement);},_enableSlider:function(){var self=this;var score=getDebtPercentage(self.totalDebt,self.totalIncome);if($(".slider-bg").length>0){$(".slider-bg").remove();}var sliderWrapper=$("<div>",{"class":"slider-bg"}).appendTo(self.$el);var slider=$("<div>",{"id":"slider","class":"noUi-ltr noUi-horizontal slider","width":self.graphWrapperWidth}).appendTo(sliderWrapper);var rangeSlider=document.getElementById("slider");noUiSlider.create(rangeSlider,{"start":[score],"range":self.settings.range});rangeSlider.noUiSlider.on("update",function(values,handle){var totalIncome=Number(self.totalIncome),dbtRatio=Math.round(values[handle]);$(".dti-wrapper").data().totalDebt=Math.round((dbtRatio/100)*totalIncome);if(self.settings.enableSlider===false){self.settings.enableSlider=true;}else{self._createGraph();}});self._enableSliderMarker();},_enableSliderMarker:function(){var self=this;if($(".slider-lbl").length>0){$(".slider-lbl").remove();}var sliderLbl=$("<div>",{"class":"clearfix slider-lbl"}).appendTo(self.$el),pointer0=$("<div>",{html:"0%",width:" 33%","aria-hidden":"true"}).appendTo(sliderLbl),pointer1=$("<div>",{html:"35%",width:" 14%","aria-hidden":"true"}).appendTo(sliderLbl),pointer2=$("<div>",{html:"49%",width:" 10%","aria-hidden":"true"}).appendTo(sliderLbl),pointer3=$("<div>",{html:"100%",width:" 10%","aria-hidden":"true"}).appendTo(sliderLbl);},_setSlider:function(){var self=this;var score=getDebtPercentage(self.totalDebt,self.totalIncome);self.settings.enableSlider=false;var rangeSlider=document.getElementById("slider");rangeSlider.noUiSlider.set(score);},init:function(){var self=this;self._createGraph();self._enableSlider();}};$.fn[pluginName]=function(options){return this.each(function(){var plugin=$.data(this,"plugin_"+pluginName);if(!$.data(this,"plugin_"+pluginName)){$.data(this,"plugin_"+pluginName,new Plugin(this,options));}else{switch(options){case"reset":plugin._createGraph();plugin._setSlider();break;}}});};};if(typeof define==="function"&&define.amd){define(["jquery"],wrapper);}else{return wrapper(window.jQuery);}}(this));