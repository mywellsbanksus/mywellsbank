function addOption(id,firstIdx,lastIdx){var selectElement=document.getElementById(id);for(var i=firstIdx;i<=lastIdx;i++){var option=document.createElement("option");option.text=i;option.value=i;selectElement.appendChild(option);}}function sanitizeError(err){const out={};const msg=err.message;out.msg=msg.replace(/[^0-9a-zA-Zñáéíóúü\-,.:&+() ]/gi,"");out.url=err.url;out.logType=err.logType;return JSON.stringify(out);}function sanitizeJSON(data){var sanitizedData={};var keyList=Object.keys(data);if(keyList&&data&&isNaN(data)){for(var key in data){if(key==="day"||key==="month"||key==="year"){sanitizedData[key]=data[key].replace(/[^0-9]/g,"");}}}return JSON.stringify(sanitizedData);}function logError(errorMessage){return fetch("/as/jsLog",{method:"POST",headers:{"Content-Type":"application/json"},body:sanitizeError(errorMessage)});}function getStockDataApi(data){return fetch("/as/getStockQuote/wfc",{method:"POST",headers:{"Content-Type":"application/json"},body:sanitizeJSON(data)}).then(function(res){return(res.json());},function(error){return logError({message:error.message,url:window.location.href,logType:"FATAL",});});}var selectedMonth=0;var selectedDay=0;var selectedYear=0;function getQuoteClassName(response){if(response["data"]["currentStockPrice"]["change"]>0){return"upquote";}else{return"downquote";}}function getCaretImage(response){if(response["data"]["currentStockPrice"]["change"]>0){return"https://www17.wellsfargomedia.com/assets/images/css/template/up_arrow.png";}else{return"https://www17.wellsfargomedia.com/assets/images/css/template/down_arrow.png";}}function convertToDecimal(value){var appendDecimal=null;if(typeof value==="number"){appendDecimal=value.toFixed(2);}return(appendDecimal||value);}function insertCurrentData(response){const fieldNames=["dateAsOf","openPrice","highPrice","lowPrice","volume","yield","peRatio"];const currentStockData=document.getElementById("currentStockData");var tableElement=document.createElement("tr");tableElement.setAttribute("id","currentStockRow");var cellElement=tableElement.insertCell();const priceSpan=document.createElement("span");priceSpan.appendChild(document.createTextNode(convertToDecimal(response["data"]["currentStockPrice"]["price"])));priceSpan.classList.add("price");cellElement.appendChild(priceSpan);cellElement=tableElement.insertCell();const caretImage=document.createElement("img");caretImage.setAttribute("src",getCaretImage(response));caretImage.setAttribute("alt","caret");cellElement.appendChild(caretImage);cellElement.appendChild(document.createTextNode(convertToDecimal(response["data"]["currentStockPrice"]["change"])));cellElement.classList.add(getQuoteClassName(response));cellElement=tableElement.insertCell();cellElement.appendChild(document.createTextNode(convertToDecimal(response["data"]["currentStockPrice"]["changePercent"])+"%"));cellElement.classList.add(getQuoteClassName(response));fieldNames.forEach(function(fieldName){const cellElement=tableElement.insertCell();const fieldValue=convertToDecimal(response["data"]["currentStockPrice"][fieldName]);if(fieldName==="yield"){cellElement.appendChild(document.createTextNode(fieldValue+"%"));}else{cellElement.appendChild(document.createTextNode(fieldValue));}});cellElement=tableElement.insertCell();cellElement.appendChild(document.createTextNode(response["data"]["currentStockPrice"]["fiftyTwoWeekHigh"]+" to "+response["data"]["currentStockPrice"]["fiftyTwoWeekLow"]));currentStockData.appendChild(tableElement);}function insertError(msg){var pageErrorElement=document.getElementsByClassName("pageError")[0];if(!pageErrorElement.hasChildNodes()){var errorElement=document.createElement("p");var excalmationImg=document.createElement("img");excalmationImg.src="https://www17.wellsfargomedia.com/assets/images/css/template/icon-exclamation-red.gif";excalmationImg.alt="error";errorElement.appendChild(excalmationImg);errorElement.role="alert";errorElement.appendChild(document.createTextNode(msg));pageErrorElement.appendChild(errorElement);}}function setCalendar(response){var monthElement=document.getElementById("month");var dayElement=document.getElementById("day");var yearElement=document.getElementById("year");const date=response["data"]["historicStockPrice"]["date"].split("/");selectedMonth=date[0];selectedDay=date[1];selectedYear=date[2];monthElement.value=selectedMonth;dayElement.value=selectedDay;yearElement.value=selectedYear;monthElement.options[selectedMonth-1].setAttribute("selected","selected");dayElement.options[selectedDay-1].setAttribute("selected","selected");yearElement.options[selectedYear-1969].setAttribute("selected","selected");}function insertHistoricalData(response){const fields=["date","lastTrade","openPrice","intraDayHigh","intraDayLow","splitAdjustment","volume"];const histData=document.querySelectorAll("#historicalStockData tr td");for(var data in histData){const fieldName=fields[data];var fieldValue=response["data"]["historicStockPrice"][fields[data]];if(fieldName==="openPrice"||fieldName==="intraDayHigh"||fieldName==="intraDayLow"){if(fieldValue===0){fieldValue="n/a";}}histData[data].textContent=convertToDecimal(fieldValue);}}window.addEventListener("DOMContentLoaded",function(){addOption("day",1,31);addOption("year",1969,new Date().getFullYear());getStockDataApi({}).then(function(data){if(data&&Object.keys(data).length>0){insertCurrentData(data);setCalendar(data);insertHistoricalData(data);}},function(error){logError({message:"Initial API call failed with "+error.message,url:window.location.href,logType:"FATAL",});});document.getElementById("historicalField").addEventListener("submit",function(event){event.preventDefault();document.querySelectorAll(".pageError p").forEach(function(error){error.remove();});var dayElement=document.getElementById("day");var monthElement=document.getElementById("month");var yearElement=document.getElementById("year");getStockDataApi({day:dayElement.value,month:monthElement.value,year:yearElement.value}).then(function(response){if(response["status"]["statusCode"]===400){var message=response["data"]["message"];insertError(message);var histData=document.querySelectorAll("#historicalStockData tr td");histData[0].textContent=response["data"]["historicStockPrice"]["date"];for(var i=1;i<=histData.length;i++){if(histData[i]&&histData[i].textContent){histData[i].textContent="";}}}else{insertHistoricalData(response);}},function(error){logError({message:"Submit API call failed with "+error.message,url:window.location.href,logType:"FATAL",});});});});