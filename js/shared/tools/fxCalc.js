var WFFX={};WFFX.Component={};WFFX.Strings={"Shared":{"errMesForeign":{"en":"Foreign Amount","es":"Monto en moneda extranjera"},"errMesUsd":{"en":"USD Amount","es":"Monto en USD"},"errMessLabel":{"en":"Error:Invalid Entry","es":"Error:Información no válida"}}};WFFX.Utils={"lang":$("html").attr("lang")||"en",hasErrorMessage:function(){if(initialState.responseCode==="FAILURE_STALE_RATES"){$("#staleError").addClass("showMessage");return false;}else{if(initialState.responseCode==="FAILURE_UNAVAILABLE"){$("#unavailableError").addClass("showMessage");$(".calcInput").attr("disabled","");$("#currencyList").prop("disabled",true);$("#currencyListTable").prop("disabled",true);$(".c69Table").remove();return true;}else{if($("#staleError, #unavailableError").hasClass("showMessage")){$("#staleError, #unavailableError").removeClass("showMessage");}return false;}}},isMobile:function(){if(typeof WFFX.Utils.isMobile.prop!=="undefined"){return WFFX.Utils.isMobile.prop;}WFFX.Utils.isMobile.prop=$("body").hasClass("wfMobile");return WFFX.Utils.isMobile.prop;},c2tClickEvent:function(applicationCode,logicalPageTitle,clickName,clickType){var stdOptions={"url":window.location.href,"applicationCode":applicationCode,"eventStructure[ClickCreator]":applicationCode+"_"+logicalPageTitle+"_Click","headerStructure[HeaderCreator]":"header_"+applicationCode,"data[clickType]":clickType,"data[clickItemName]":clickName};WF.Utils.logC2tEvent(stdOptions);},getC2TClickInfo:function(e){var target,clickType,clickName,logicalPageTitle;target=$(e);clickType="LINK";logicalPageTitle="TRAVEL_TIPS";clickName=target.text();if(target.is("#ctaCol .c10 a.c7")||target.is(".c10m-cta a.c7")){clickType="BUTTON";logicalPageTitle="SIGNON";}WFFX.Utils.c2tClickEvent("FX",logicalPageTitle,clickName,clickType);},sortCurrencyList:function(){return initialState.currencyList.sort(function(o1,o2){var t1=o1.countryName.toLowerCase(),t2=o2.countryName.toLowerCase();return t1>t2?1:t1<t2?-1:0;});}};$(document).ready(function(){if(window.initialState){var message=WFFX.Utils.hasErrorMessage();if(!message){if(initialState.currencyList&&initialState.currencyList.length>0){initialState.currencyList=WFFX.Utils.sortCurrencyList();WFFX.setupCalculator();WFFX.Component.TableOfCurrencies();}}}$(document).on("click","#ctaCol .c10 a.c7, .wfMobile .c10m-cta a.c7, #serviceModule a.c13",function(e){WFFX.Utils.getC2TClickInfo(e.target);});$(document).on("keypress","#ctaCol .c10 a.c7, .wfMobile .c10m-cta a.c7, #serviceModule a.c13",function(e){var keycode=(e.keyCode?e.keyCode:e.which);if(keycode=="13"){WFFX.Utils.getC2TClickInfo(e.target);}});});WFFX.Component.Calculator=function(el){var FXself=this;var positionOrigDec=0;var inputWithDecimal="";this.convertCurrency=function(triggeredInput){var conversionAmountText;var inputVal=triggeredInput.value;if(isNaN(inputVal)||inputVal.length<2||(inputVal.indexOf(".")!==-1)){triggeredInput.classList.add("showRedBorder");$("#invalidInputError").addClass("showMessage");if(triggeredInput.id==="foreignCurrAmount"){el.find("#foreignAmountErrorImg").addClass("showMessage");$("#foreignCurrAmount").attr("aria-describedby","invalidInputError");$("#foreignUsdErrMess").text(WFFX.Strings.Shared.errMesForeign[WFFX.Utils.lang]);$("#foreignErrorLabel").text(WFFX.Strings.Shared.errMessLabel[WFFX.Utils.lang]);}else{el.find("#usAmountErrorImg").addClass("showMessage");$("#usCurrAmount").attr("aria-describedby","invalidInputError");$("#foreignUsdErrMess").text(WFFX.Strings.Shared.errMesUsd[WFFX.Utils.lang]);$("#usdErrorLabel").text(WFFX.Strings.Shared.errMessLabel[WFFX.Utils.lang]);}$("#adaConversionAmt").text("");return;}else{el.find(".calcInput").removeClass("showRedBorder");el.find(".calcInput").attr("aria-describedby","");$("#foreignUsdErrMess").text("");$(".errorInputLabel").text("");$("#invalidInputError").removeClass("showMessage");el.find(".labelErrorImage").removeClass("showMessage");}var currentOptionSelection=$("#currencyList").val();for(var i=0;i<initialState.currencyList.length;i++){if(initialState.currencyList[i]["countryCode"]===currentOptionSelection){var exchangeRate=initialState.currencyList[i]["exchangeRate"];if(triggeredInput.id==="foreignCurrAmount"){var convertAmount=(Number(inputVal)*Number(exchangeRate)).toFixed(2);el.find("#usCurrAmount").val(""+convertAmount+"");inputWithDecimal="usCurrAmount";conversionAmountText=inputVal+" "+$("#forLabel").text()+" = "+convertAmount+" USD";}else{var convertAmount=(Number(inputVal)/Number(exchangeRate)).toFixed(2);el.find("#foreignCurrAmount").val(""+convertAmount+"");inputWithDecimal="foreignCurrAmount";conversionAmountText=inputVal+" USD"+" = "+convertAmount+" "+$("#forLabel").text();}}}positionOrigDec=convertAmount.indexOf(".");$("#adaConversionAmt").text(conversionAmountText);};this.getEuroLightBox=function(){(el.find("#currencyList").val()==="EU")?el.find(".calcLightbox").addClass("showMessage"):el.find(".calcLightbox").removeClass("showMessage");};this.setUpDropDown=function(){var documentFragmentPop=document.createDocumentFragment();var documentFragmentOther=document.createDocumentFragment();for(var i=0;i<initialState.currencyList.length;i++){var optionDropDown=document.createElement("option");var dropDownText=document.createTextNode(initialState.currencyList[i]["countryName"]+" "+"("+initialState.currencyList[i]["currencyName"]+")");optionDropDown.appendChild(dropDownText);optionDropDown.setAttribute("value",""+initialState.currencyList[i]["countryCode"]+"");if(initialState.currencyList[i]["countryName"]==="EUROZONE"){el.find("#rateLabel").text("1 "+initialState.currencyList[i]["currencyName"]+" ("+initialState.currencyList[i]["currencyCode"]+") = "+initialState.currencyList[i]["exchangeRate"]+" U.S. dollar (USD)");el.find(".calcLightbox").addClass("showMessage");}if(initialState.currencyList[i]["popularCurrencyInd"]==="Y"){documentFragmentPop.appendChild(optionDropDown);}else{documentFragmentOther.appendChild(optionDropDown);}}var otherCurr=document.querySelectorAll("select optgroup.optOtherCurr");var popCurr=document.querySelectorAll("select optgroup.optPopCurr");if(WFFX.Utils.lang==="es"){$(".optPopCurr").attr("label","Monedas populares");$(".optOtherCurr").attr("label","Otras monedas");}for(var i=0;i<otherCurr.length;i++){otherCurr[i].appendChild(documentFragmentOther.cloneNode(true));popCurr[i].appendChild(documentFragmentPop.cloneNode(true));}$('option[value="EU"]').prop("selected",true);};this.showRatesLabel=function(){var currentOptionText=$("#currencyList :selected").text();var currentOption=currentOptionText.substring(0,currentOptionText.indexOf("(")).trim();for(var i=0;i<initialState.currencyList.length;i++){if(initialState.currencyList[i]["countryName"]===currentOption){el.find("#rateLabel").text("1 "+initialState.currencyList[i]["currencyName"]+" ("+initialState.currencyList[i]["currencyCode"]+") = "+initialState.currencyList[i]["exchangeRate"]+" U.S. dollar (USD)");el.find("#forLabel").text(initialState.currencyList[i]["currencyCode"]);}}};this.inputValidationDesktop=function(){el.find(".calcInput").on("keypress input",function(evt){var charCode=(evt.which)?evt.which:evt.keyCode;if(charCode>31&&(charCode<48||charCode>57)){evt.preventDefault();}});};this.inputValidationMobile=function(){var previousValueNoDecimal;el.find(".calcInput").on("blur",function(evt){previousValueNoDecimal=false;});el.find(".calcInput").on("input",function(evt){var targetEvt,hasDecimal,inputText,arrInputText,numOfDecimalPts;targetEvt=evt.srcElement||evt.target;hasDecimal=false;inputText=$(this).val();arrInputText=inputText.split("");numOfDecimalPts=arrInputText.filter(function(dec1){return dec1===".";}).length;if(targetEvt.id===inputWithDecimal){if(numOfDecimalPts===0){previousValueNoDecimal=true;}if(previousValueNoDecimal===true){hasDecimal=false;}else{hasDecimal=true;previousValueNoDecimal=false;}if(numOfDecimalPts>1){for(var p=0;p<arrInputText.length;p++){if(arrInputText[p]==="."&&positionOrigDec!==p){inputText=inputText.substr(0,p)+inputText.substr(p+1);break;
}}}}var resultText=(hasDecimal)?inputText.replace(/[^\d*\.?\d*]/,""):inputText.replace(/[^0-9]/g,"");$(this).val(resultText);});};this.setUp=function(){this.setUpDropDown();if(navigator.userAgent.match(/Android/i)){this.inputValidationMobile();}else{this.inputValidationDesktop();}el.find("#currencyList, #foreignCurrAmount, #usCurrAmount").on("change",function(evt){var targetEvt=evt.srcElement||evt.target;if(el.find("#currencyList option").length>0){if(targetEvt.id==="currencyList"){el.find(".calcInput").attr("aria-describedby","");$("#foreignUsdErrMess").text("");$(".errorInputLabel").text("");$("#adaConversionAmt").text("");el.find(".calcInput").val("");el.find(".calcInput").removeClass("showRedBorder");el.find(".labelErrorImage").removeClass("showMessage");$("#invalidInputError").removeClass("showMessage");FXself.getEuroLightBox();FXself.showRatesLabel();}else{FXself.convertCurrency(targetEvt);}}});el.find(".calcInput").on("keydown",function(evt){if(evt.which===13){$(this).change();}});};this.setUp();};WFFX.setupCalculator=function(){if($("body").find(".marqueecontainer").length>0){new WFFX.Component.Calculator($(".marqueecontainer"));}};WFFX.Component.TableOfCurrencies=function(){$("#currencyListTable").prop("selectedIndex",0);$("#popularcurrencies, #allcurrencies").attr("tabindex","0");$("#monedaspopulares, #todaslasmonedas").attr("tabindex","0");createTable=function(){var documentFragmentAll=document.createDocumentFragment();var documentFragmentPop=document.createDocumentFragment();for(var i=0;i<initialState.currencyList.length;i++){row=formatTable(i);documentFragmentAll.appendChild(row.cloneNode(true));if(initialState.currencyList[i]["popularCurrencyInd"]==="Y"){documentFragmentPop.appendChild(row.cloneNode(true));}}document.querySelector(".allCurrencyTable tbody").appendChild(documentFragmentAll);document.querySelector(".popularCurrencyTable tbody").appendChild(documentFragmentPop);};formatTable=function(i){var currencyCode,trTag,tdTag1,tdTag2,tdTag3,tdTag4,tdTag1text,tdTag2text,tdTag3text,row;currencyCode=initialState.currencyList[i]["currencyCode"];trTag=document.createElement("tr");tdTag1=trTag.appendChild(document.createElement("td"));tdTag2=trTag.appendChild(document.createElement("td"));tdTag1text=document.createTextNode(initialState.currencyList[i]["countryName"]+" ");tdTag2text=document.createTextNode(""+initialState.currencyList[i]["currencyName"]+" ("+currencyCode+")"+"");tdTag3text=document.createTextNode(""+"1 "+currencyCode+" = "+initialState.currencyList[i]["exchangeRate"]+" USD"+"");tdTag1.appendChild(tdTag1text);tdTag2.appendChild(tdTag2text);trTag.appendChild(tdTag1);trTag.appendChild(tdTag2);if(WFFX.Utils.isMobile()){tdTag2.appendChild(document.createElement("br"));tdTag2.appendChild(tdTag3text);tdTag4=trTag.appendChild(document.createElement("td"));tdTag4.setAttribute("class","tdEmptyStyler");trTag.appendChild(tdTag4);}else{tdTag3=trTag.appendChild(document.createElement("td"));tdTag3.appendChild(tdTag3text);trTag.appendChild(tdTag3);}row=trTag;return row;};searchforCurrency=function(){var allTable=$(".allCurrencyTable");allTable.find("tr:not(:first)").remove();var index=$("#currencyListTable").val();if(WFFX.Utils.isMobile()){allTable.find("tr").remove();}if(typeof initialState.currencyList!=="undefined"){for(var i=0;i<initialState.currencyList.length;i++){if(initialState.currencyList[i]["countryCode"]===index){var row=formatTable(i);document.querySelector(".allCurrencyTable tbody").appendChild(row);}}}};setUp=function(){if(WFFX.Utils.isMobile()){$(".c69Table thead").remove();$('a[href="#Grid-Table-1"], a[href="#Grid-Table-2"], #Grid-Table-1, #Grid-Table-2').remove();}createTable();$("#currencyListTable").on("change",function(event){if($("#currencyListTable option").length>0){event.stopPropagation();searchforCurrency();}});};setUp();};$(document).ready(function(){$(".calcLightbox").on("click",function(e){e.preventDefault?e.preventDefault():e.returnValue=false;});});