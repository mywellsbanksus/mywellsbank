var GRS={lang:$("html").attr("lang"),lastValid:"",grsDestBankFootnote:$(".grsDestBank").html(),grsBanknameText:$(".grsBankName:first").text(),initForm:function(grsObj){GRS.disableButton();$("#errorMsg").html("");$("#errorMsg").removeClass("errorMsgDisplay");if(grsObj.invalidField!==""||grsObj.invalidField!=null){$("#"+grsObj.invalidField+"Header").find("label").removeClass("pageError");$("#"+grsObj.invalidField).removeClass("fieldError");$("#"+grsObj.invalidField+"Header").find("label").find("img").remove();grsObj.invalidField="";}GRS.disableAmount();$("#estimate").slideUp(function(){$(".grsCTA").slideUp();});$("#disclaimer").slideUp();$("#sendAmtdDisclaimer").slideUp();},disableButton:function(){$("#estimateButton").addClass("faded");$("#estimateButton").attr("disabled",true);},enableButton:function(){$("#estimateButton").removeClass("faded");$("#estimateButton").attr("disabled",false);},disableMethod:function(){$("#method").val("selectOne");$("#method").attr("disabled",true);$("#method").css("opacity",0.5);},enableMethod:function(){$("#method").attr("disabled",false);$("#method").css("opacity",1);},enableLocation:function(){$("#location").attr("disabled",false);$("#location").css("opacity",1);},enableAmount:function(){$("#sendAmount").attr("disabled",false);$("#sendAmount").removeClass("disabled");$("#sendAmount").val("");},disableAmount:function(){$("#sendAmount").val("");$("#sendAmount").attr("disabled",true);$("#sendAmount").addClass("disabled");},disableLocation:function(){$("#location").val("selectOne");$("#location").attr("disabled",true);$("#location").css("opacity",0.5);},populateNextMenu:function(data,menuName,grsObj){if(data.responseCode!=="success"){GRS.errorThrown(data,grsObj);}else{try{if(menuName==="location"&&data.informationMessage!=null){$("#usdDisclaimer").html(data.informationMessage);setTimeout(function(){$("#usdDisclaimer").slideDown();},100);}else{if(menuName==="location"&&data.informationMessage==null){$("#usdDisclaimer").slideUp();}}}catch(error){$("#usdDisclaimer").slideUp();}var menu=$("#"+menuName);menu.attr("disabled",false);menu.html("");var option=document.createElement("option");option.value="selectOne";if(GRS.lang=="en"){option.innerHTML="Select One";}else{option.innerHTML="Seleccione uno";}menu.append(option);var opts=data[grsObj.menus[menuName]];for(var i in opts){var option=document.createElement("option");option.value=i;option.innerHTML=opts[i];menu.append(option);}}},checkAmount:function(grsObj){$("#errorMsg").html("");$("#errorMsg").removeClass("errorMsgDisplay");if(grsObj.invalidField!==""){$("#"+grsObj.invalidField+"Header").find("label").removeClass("pageError");$("#"+grsObj.invalidField).removeClass("fieldError");$("#"+grsObj.invalidField+"Header").find("label").find("img").remove();grsObj.invalidField="";}$("#estimate").slideUp(function(){$(".grsCTA").slideUp();});var sendAmt=$("#sendAmount").val();var paymentType=$("#method").val();var formData={country:grsObj.country,location:grsObj.rnm,method:paymentType,sendAmount:sendAmt,lang:GRS.lang};$.ajax({timeout:10000,url:grsObj.base+"country/rnm/paymentMethod/amount",global:false,type:"POST",data:formData,dataType:"json",async:true,error:function(data){GRS.errorThrown(data,grsObj);},success:function(data){GRS.showResults(data,grsObj);},complete:function(jqXHR,textStatus){}});},errorThrown:function(data,grsObj){setTimeout(function(){GRS.enableButton();$("#zipStateForm").hide().removeAttr("aria-live","polite");var error=data.errorMessage;if(error!=null||error!=undefined){var errorMsg="<img src='"+assetsBasePath+"/assets/images/css/template/icon-exclamation-red.gif' align='top' alt='Error'>";errorMsg+=error;if(data.responseCode==="validationFailure"){grsObj.invalidField=data.invalidFields.id;$("#errorMsg").html(errorMsg);var errorImg=document.createElement("img");errorImg.src=assetsBasePath+"/assets/images/css/template/icon-exclamation-red.gif";errorImg.alt="Error";$("#"+grsObj.invalidField+"Header").find("label").addClass("pageError");$("#"+grsObj.invalidField).addClass("fieldError");if(!$("#"+grsObj.invalidField+"Header").find("label").has("img").length){$("#"+grsObj.invalidField+"Header").find("label").prepend(errorImg);}}else{if(data.responseCode==="failure"){$("#errorMsg").html(errorMsg);}}$("#errorMsg").addClass("errorMsgDisplay").attr({"tabindex":-1,"role":"alert","aria-atomic":"true"});$("#errorMsg").focus();}else{var errorMsg="<img src='"+assetsBasePath+"/assets/images/css/template/icon-exclamation-red.gif' align='top' alt='Error'>";if(GRS.lang=="en"){errorMsg=errorMsg+"We're sorry. The estimator is temporarily unavailable. Please try again later.";}else{errorMsg=errorMsg+"Disculpe. En este momento no podemos proporcionarle un estimado. Intente de nuevo m√°s tarde.";}$("#errorMsg").html(errorMsg);$("#errorMsg").addClass("errorMsgDisplay").attr({"tabindex":-1,"role":"alert","aria-atomic":"true"});$("#errorMsg").focus();}},1000);},showResults:function(data,grsObj){if(data.responseCode!=="success"){GRS.errorThrown(data,grsObj);}else{setTimeout(function(){GRS.enableButton();$("#zipStateForm").hide().removeAttr("aria-live","polite");$("#estimate").slideDown(function(){$(".grsCTA").slideDown();$(".grsDestinationWrapper h3").attr("tabindex","-1").focus();});GRS.parseResultsdata(data);$("html, body").animate({scrollTop:$("#grsResults").height()});},1000);}},GRS_Obj:function(){this.base="/as/grs/";this.invalidField="";this.country="";this.rnm="";this.paymentType="";this.amount="";this.lb=null;this.menus={"location":"rnmMap","method":"paymentTypes"};},GRSEventBindings:function(grsObj){$("#country").val("selectOne");$("#countryCell").keydown(function(e){if($("#country").val()!="selectOne"){GRS.enableLocation();}});$("#country").change(function(){GRS.initForm(grsObj);GRS.disableMethod();grsObj.country=$(this).val();var formData={country:grsObj.country,lang:GRS.lang};if(grsObj.country!=="selectOne"){$.ajax({timeout:10000,url:grsObj.base+"country",global:false,type:"POST",data:formData,dataType:"json",async:true,error:function(data){$("#usdDisclaimer").slideUp();},success:function(data){GRS.populateNextMenu(data,"location",grsObj);}});GRS.enableLocation();}else{GRS.disableLocation();$("#usdDisclaimer").slideUp();$("#sendAmtdDisclaimer").slideUp();}});$("#location").keydown(function(e){if($("#location").val()!="selectOne"){GRS.enableMethod();}});$("#location").change(function(){GRS.initForm(grsObj);GRS.disableMethod();grsObj.rnm=$(this).val();var formData={country:grsObj.country,location:grsObj.rnm,lang:GRS.lang};if(grsObj.rnm!=="selectOne"){$.ajax({timeout:10000,url:grsObj.base+"country/rnm",global:false,type:"POST",data:formData,dataType:"json",async:true,error:function(data){ajaxError(selected);},success:function(data){GRS.populateNextMenu(data,"method",grsObj);}});GRS.enableMethod();}else{GRS.disableMethod();}});$("#method").keydown(function(e){$("#sendAmount").attr("disabled",false);$("#sendAmount").removeClass("disabled");});$("#method").change(function(){GRS.initForm(grsObj);if($(this).val()!=="selectOne"){GRS.enableAmount();GRS.disableButton();$("#estimate").slideUp(function(){$(".grsCTA").slideUp();});if($(this).val()==="CASH_TO_ACCT"||$(this).val()==="CASH_TO_CASH"){$("#disclaimer").slideDown();}else{$("#disclaimer").slideUp();}}else{$("#disclaimer").slideUp();GRS.disableButton();GRS.disableAmount();}});$("input[id*='sendAmount']").on("input",function(event){var numInput=$(this).val().replace(/[^0-9\.]|^0|^\.+/g,"");var validNumber=new RegExp(/^\d+\.?\d{0,2}$/);if(validNumber.test(numInput)||numInput==""){$(this).val(numInput.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"));GRS.lastValid=$("input[id*='sendAmount']").val();}else{numInput=GRS.lastValid;$(this).val(numInput);}if($(this).val()){GRS.enableButton();}else{GRS.disableButton();}});$("#estimateButton").click(function(){$(".c61Close").click();});$(".grsHelp a").off("click").on("click",function(){GRS.fireC2TConsiderationEvent("GRS",$(this).html(),"LINK");});$(".grsCTA").off("click").on("click",".secondHalf a,.c10m-cta-section a",function(){var linkType="";
if($(this).hasClass("c7")){linkType="BUTTON";}else{linkType="LINK";}GRS.fireC2TCompletionEvent("GRS",$(this).html(),linkType);});},fireC2TCompletionEvent:function(applicationCode,clickName,clickType){var stdOptions={"log":1,"url":window.location.href,"applicationCode":applicationCode,"eventsOrder":[{"CompletionCreator":"1"},{"ClickCreator":"2"}],"eventStructure[ClickCreator]":applicationCode+"_"+clickType+"_Click","eventStructure[CompletionCreator]":applicationCode+"_Completion","headerStructure[HeaderCreator]":"header_"+applicationCode,"data[clickType]":clickType,"data[clickItemName]":clickName};GRS.logC2TtoolEvent(stdOptions);},fireC2TConsiderationEvent:function(applicationCode,clickName,clickType){var stdOptions={"log":1,"url":window.location.href,"applicationCode":applicationCode,"eventsOrder":[{"ConsiderationCreator":" 1"},{"ClickCreator":"2"}],"eventStructure[ConsiderationCreator]":applicationCode+"_Consideration","eventStructure[ClickCreator]":applicationCode+"_"+clickType+"_Click","headerStructure[HeaderCreator]":"header_"+applicationCode,"data[clickType]":clickType,"data[clickItemName]":clickName};GRS.logC2TtoolEvent(stdOptions);},logC2TtoolEvent:function(toolsData){$.ajax({url:"/c2tEvents/event",type:"POST",data:toolsData});},parseResultsdata:function(jsonResponse){$(".grsDestCountry").text(jsonResponse["receivingCountry"]);$(".grsDestBank").html(jsonResponse["rnm"]+GRS.grsDestBankFootnote);$(".grsDestMethod").text(jsonResponse["paymentMethod"]);$(".grsBankName").html(GRS.grsBanknameText+" "+jsonResponse["receivingCountry"]+" - "+jsonResponse["rnm"]+":");if(jsonResponse["formattedFxRate"]!=null){$(".grsCurrentExchange").parent().css("display","block");$(".grsCurrentExchange").text(jsonResponse["formattedFxRate"]);}else{$(".grsCurrentExchange").parent().css("display","none");}$(".grsDeliveryAmount").text(jsonResponse["formattedDeliveyAmount"]);$(".grsAmount").text(jsonResponse["requestedAmount"]);$(".grsTransferFee").text(jsonResponse["formattedTransferFeeString"]);$(".grsTotal").text(jsonResponse["totalAmount"]);$.each(jsonResponse["transferFeesMap"],function(amnt,rate){$(".grsTransferFees table").append(' <tr><td class="transferAmount">'+amnt+'</td><td class="transferFees">'+rate+"</td> </tr>");});if(jsonResponse["paymentFromCashFlag"]){$(".paymentFromCashFlag").css("display","block");}else{$(".paymentFromCashFlag").css("display","none");}if(jsonResponse["deliveryAmountCurrencyFlag"]){$(".deliveryAmountCurrencyFlag").css({"display":"block","padding-bottom":"15px"});$(".grsTotal").css("padding-bottom","0");$(".deliveryAmountCurrencyFlag>span").text(jsonResponse["receivingCountry"]);}else{$(".deliveryAmountCurrencyFlag").css("display","none");$(".grsTotal").css("padding-bottom","15px");}if(jsonResponse["fxRateMapFlag"]){$.each(jsonResponse["fxRateMap"],function(amnt,rate){$(".exchangeGrsDestination").append(' <tr><td class="exchangeAmount">'+amnt+'</td><td class="exchangeRate">'+rate+"</td> </tr>");});$(".grsExchange").css("display","block");$(".grsTransferFees").css("border-bottom","1px solid #d6d6d6");}else{$(".grsExchange").css("display","none");$(".grsTransferFees").css("border-bottom","none");}if(jsonResponse["paymentFromAccountFlag"]){$(".paymentFromAccount").css("display","block");$(".paymentFromAccount a").attr("href",jsonResponse["wibURL"]);$(".paymentFromCash").css("display","none");}else{$(".paymentFromAccount").css("display","none");$(".paymentFromCash").css("display","block");}if(jsonResponse["specialOffers"]!=null){$(".special-offers").addClass("special-offers-styles");$.each(jsonResponse["specialOffers"],function(index,value){$(".special-offers ul").append("<li>"+value+"</li>");});$(".special-offers").css("display","block");$(".grsResults").css("margin-bottom","10px");}else{$(".special-offers").removeClass("special-offers-styles");$(".special-offers").css("display","none");$(".special-offers ul li").remove();$(".grsResults").css("margin-bottom","0");}},};$(document).ready(function(){var grsObj=new GRS.GRS_Obj();GRS.initForm(grsObj);GRS.disableMethod();$("#country").val("selectOne");GRS.disableLocation();GRS.GRSEventBindings(grsObj);$("#grsExpressForm").submit(function(){GRS.checkAmount(grsObj);$(".c16m-showhide .exchangeGrsDestination tr:gt(0)").remove();$(".c16 .exchangeGrsDestination tr:gt(0)").remove();$(".grsTransferFees .c16m-showhide table tr:gt(0)").remove();$(".grsTransferFees .c16 table tr:gt(0)").remove();$(".grsBankName").text("");$(".special-offers ul li").remove();$(".grsDestBank").text("");$("#zipStateForm").show().attr("aria-live","polite");GRS.disableButton();return false;});});